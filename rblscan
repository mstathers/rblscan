#!/bin/bash
# Scans IP against blocklists
# Enter the IP address to test it

# Uses input to define needed information
ADDRESS=$1
BACKADDRESS=$(echo $ADDRESS | sed -r 's/([0-9]{1,3}).([0-9]{1,3}).([0-9]{1,3}).([0-9]{1,3})/\4.\3.\2.\1/')
REVERSE=$(dig -x $ADDRESS +short)


# Checks for variables and gives a short help menu just in case
while getopts ":h" opt; do
    case $opt in
        h)
            echo "IP Blocklist checker" >&2
            echo ""
            echo "Usage: rblscan [ip address]" >&2
            echo ""
            exit 1
            ;;
        \?)
            echo "Invalid option: -$OPTARG" >&2
            echo "Please use -h for help" >&2
            exit 1
            ;;
    esac
done

# List of RBLs
LISTS="
b.barracudacentral.org
bb.barracudacentral.org
bl.deadbeef.com
bl.emailbasura.org
bl.spamcannibal.org
bl.spamcop.net
blackholes.five-ten-sg.com
blacklist.woody.ch
bogons.cymru.com
cbl.abuseat.org
cdl.anti-spam.org.cn
cidr.bl.mcafee.com
combined.abuse.ch
combined.rbl.msrbl.net
db.wpbl.info
dnsbl-1.uceprotect.net
dnsbl-2.uceprotect.net
dnsbl-3.uceprotect.net
dnsbl.cyberlogic.net
dnsbl.inps.de
dnsbl.njabl.org
dnsbl.sorbs.net
drone.abuse.ch
drone.abuse.ch
duinv.aupads.org
dul.dnsbl.sorbs.net
dul.ru
dyna.spamrats.com
dynip.rothen.com
http.dnsbl.sorbs.net
images.rbl.msrbl.net
ips.backscatterer.org
ix.dnsbl.manitu.net
korea.services.net
misc.dnsbl.sorbs.net
noptr.spamrats.com
ohps.dnsbl.net.au
omrs.dnsbl.net.au
orvedb.aupads.org
osps.dnsbl.net.au
osrs.dnsbl.net.au
owfs.dnsbl.net.au
owps.dnsbl.net.au
pbl.spamhaus.org
phishing.rbl.msrbl.net
probes.dnsbl.net.au
proxy.bl.gweep.ca
proxy.block.transip.nl
psbl.surriel.com
rbl.interserver.net
rbl.megarbl.net
rdts.dnsbl.net.au
relays.bl.gweep.ca
relays.bl.kundenserver.de
relays.nether.net
residential.block.transip.nl
ricn.dnsbl.net.au
rmst.dnsbl.net.au
sbl.spamhaus.org
short.rbl.jp
smtp.dnsbl.sorbs.net
socks.dnsbl.sorbs.net
spam.abuse.ch
spam.dnsbl.sorbs.net
spam.rbl.msrbl.net
spam.spamrats.com
spamlist.or.kr
spamrbl.imp.ch
t3direct.dnsbl.net.au
tor.dnsbl.sectoor.de
torserver.tor.dnsbl.sectoor.de
ubl.lashback.com
ubl.unsubscore.com
virbl.bit.nl
virus.rbl.jp
virus.rbl.msrbl.net
web.dnsbl.sorbs.net
wormrbl.imp.ch
xbl.spamhaus.org
zen.spamhaus.org
zombie.dnsbl.sorbs.net
"

# Basic Functions

if [[ $( dig txt $BACKADDRESS.query.senderbase.org | grep "25=0") ]] ; then
        REPUTATION="Neutral or Better"
else
        REPUTATION="Poor"
fi

# Begin Output
echo "+----------------------------------------------------------------------+"
echo "      IP Address is: "  $ADDRESS
echo "      Reverse DNS (if any) is: " $REVERSE
echo "      Senderbase Reptation is: " $REPUTATION
echo "+----------------------------------------------------------------------+"
echo " "
echo " "
echo "Running query now, this may take some time..."
echo "If nothing comes up, you're not listed on known blacklists."

# Runs the check against the list of RBLs then prints a result if it is listed
for LI in ${LISTS} ; do
     if [[ $(dig  +short ${BACKADDRESS}.${LI}.) =~ 127.0.0.[2-50] ]] ; then
        echo "This is listed in ${LI}"
    fi
done
